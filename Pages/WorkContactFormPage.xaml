<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:AppMMR.ViewModels"
             xmlns:model="clr-namespace:AppMMR.Models"
             x:DataType="vm:WorkContactFormViewModel"
             x:Class="AppMMR.Pages.WorkContactFormPage"
             Title="添加项目联系人">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">
            <!-- 联系人选择 -->
            <VerticalStackLayout Spacing="8">
                <Label Text="选择联系人"
                       TextColor="{StaticResource Gray900}"
                       FontSize="14"/>
                <Picker ItemsSource="{Binding AvailableContacts}"
                        SelectedItem="{Binding SelectedContact}"
                        ItemDisplayBinding="{Binding Name}"
                        Title="请选择联系人"/>
            </VerticalStackLayout>

            <!-- 联系人信息预览 -->
            <Frame IsVisible="{Binding SelectedContact, Converter={StaticResource IsNotNullConverter}}"
                   BackgroundColor="White"
                   BorderColor="Transparent"
                   HasShadow="True"
                   Padding="15"
                   CornerRadius="8">
                <VerticalStackLayout Spacing="8">
                    <!-- 手机号 -->
                    <Label IsVisible="{Binding SelectedContact.Phone, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                           TextColor="{StaticResource Gray600}"
                           FontSize="14">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="手机："/>
                                <Span Text="{Binding SelectedContact.Phone}"/>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>

                    <!-- 邮箱 -->
                    <Label IsVisible="{Binding SelectedContact.Email, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                           TextColor="{StaticResource Gray600}"
                           FontSize="14">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="邮箱："/>
                                <Span Text="{Binding SelectedContact.Email}"/>
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                </VerticalStackLayout>
            </Frame>

            <!-- 收支类型 -->
            <Grid ColumnDefinitions="*, Auto" ColumnSpacing="15">
                <Label Grid.Column="0"
                       Text="收支类型"
                       TextColor="{StaticResource Gray900}"
                       FontSize="14"
                       VerticalOptions="Center"/>
                <Switch Grid.Column="1"
                        IsToggled="{Binding IsCome}"
                        OnColor="{StaticResource Primary}"
                        ThumbColor="{StaticResource White}"/>
                <Label Grid.Column="1"
                       Text="{Binding IsCome, Converter={StaticResource BoolToIncomeTypeConverter}}"
                       TextColor="{StaticResource Gray600}"
                       FontSize="12"
                       Margin="0,0,50,0"
                       VerticalOptions="Center"/>
            </Grid>

            <!-- 金额 -->
            <VerticalStackLayout Spacing="8">
                <Label Text="金额"
                       TextColor="{StaticResource Gray900}"
                       FontSize="14"/>
                <Entry Text="{Binding Amount}"
                       Keyboard="Numeric"
                       Placeholder="请输入金额"/>
            </VerticalStackLayout>


            <!-- 按钮 -->
            <Grid ColumnDefinitions="*,*" 
                  ColumnSpacing="20"
                  Margin="0,20,0,0">
                <Button Grid.Column="0"
                        Text="取消"
                        Command="{Binding CancelCommand}"
                        BackgroundColor="{StaticResource Gray200}"
                        TextColor="{StaticResource Gray900}"/>

                <Button Grid.Column="1"
                        Text="保存"
                        Command="{Binding SaveCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"/>
            </Grid>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>